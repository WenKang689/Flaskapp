<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weekly Report</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <header>
        <h1>Welcome to Laptop Finder</h1>
        <ul>
            <li><a href="/">Home</a></li>
            <li><a href="/manager/homepage">Find a Laptop</a></li>
            <li><a href="/manager/account">Manage Account</a></li>
            <li><a href="/manager/reports">Reports</a></li>
            <li><a href="/manager/feedback">Manage Feedback</a></li>
        </ul>
    </header>

    <h1>Weekly Report for {{ selected_date }}</h1>
    <!-- Form to select date -->
    <form method="post" action="/manager/reports/weekly">
        <label for="date">Select Date:</label>
        <input type="date" id="date" name="date" value="{{ date_week }}">
        <input type="submit" value="Submit">
    </form>
    
    <!-- Weekly Report Table -->
    <h2>Report Data</h2>
    <table border="1">
        {% if weekly_report %}
        <thead>
            <tr>
                <th>Date</th>
                <th>Total Sales</th>
                <th>Total Products Sold</th>
                <th>Total New Users</th>
                <th>Total Orders</th>
            </tr>
        </thead>
        <tbody>
            {% for row in weekly_report %}
                <tr>
                    <td>{{ row[0] }}</td>
                    <td>${{ row[1] }}</td>
                    <td>{{ row[2] }}</td>
                    <td>{{ row[3] }}</td>
                    <td>{{ row[4] }}</td>
                </tr>
            {% endfor %}
        {% else %}
            <p>No data available for the selected date.</p>
        {% endif %}
        </tbody>
    </table>
    
    <!-- Top Selling Products Table -->
    <h2>Top Selling Products</h2>
    {% if top_product %}
        <table border="1">
            <thead>
                <tr>
                    <th>Rank</th>
                    <th>Product ID</th>
                    <th>Product Name</th>
                    <th>Total Sold</th>
                </tr>
            </thead>
            <tbody>
                {% for row in top_product %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td>{{ row[0] }}</td>
                        <td>{{ row[1] }}</td>
                        <td>{{ row[2] }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No top-selling product data available for the selected date.</p>
    {% endif %}

    <!-- Charts -->
    <h2>Weekly Charts</h2>
    <canvas id="salesChart" width="400" height="200"></canvas>
    <canvas id="productSoldChart" width="400" height="200"></canvas>
    <canvas id="newUserChart" width="400" height="200"></canvas>
    <canvas id="ordersChart" width="400" height="200"></canvas>

    <script>
        // Data for the charts
        const reportData = {
            labels: [{% for row in weekly_chart %}"{{ row[0] }}"{% if not loop.last %}, {% endif %}{% endfor %}],
            datasets: [{
                label: 'Total Sales',
                data: [{% for row in weekly_chart %}{{ row[1] }}{% if not loop.last %}, {% endif %}{% endfor %}],
                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 1
            }]
        };

        const productSoldData = {
            labels: reportData.labels,
            datasets: [{
                label: 'Total Products Sold',
                data: [{% for row in weekly_chart %}{{ row[2] }}{% if not loop.last %}, {% endif %}{% endfor %}],
                backgroundColor: 'rgba(153, 102, 255, 0.2)',
                borderColor: 'rgba(153, 102, 255, 1)',
                borderWidth: 1
            }]
        };

        const newUserData = {
            labels: reportData.labels,
            datasets: [{
                label: 'Total New Users',
                data: [{% for row in weekly_chart %}{{ row[3] }}{% if not loop.last %}, {% endif %}{% endfor %}],
                backgroundColor: 'rgba(255, 159, 64, 0.2)',
                borderColor: 'rgba(255, 159, 64, 1)',
                borderWidth: 1
            }]
        };

        const ordersData = {
            labels: reportData.labels,
            datasets: [{
                label: 'Total Orders',
                data: [{% for row in weekly_chart %}{{ row[4] }}{% if not loop.last %}, {% endif %}{% endfor %}],
                backgroundColor: 'rgba(255, 99, 132, 0.2)',
                borderColor: 'rgba(255, 99, 132, 1)',
                borderWidth: 1
            }]
        };

        // Create charts
        new Chart(document.getElementById('salesChart').getContext('2d'), {
            type: 'bar',
            data: reportData,
            options: { responsive: true }
        });

        new Chart(document.getElementById('productSoldChart').getContext('2d'), {
            type: 'bar',
            data: productSoldData,
            options: { responsive: true }
        });

        new Chart(document.getElementById('newUserChart').getContext('2d'), {
            type: 'bar',
            data: newUserData,
            options: { responsive: true }
        });

        new Chart(document.getElementById('ordersChart').getContext('2d'), {
            type: 'bar',
            data: ordersData,
            options: { responsive: true }
        });
    </script>
</body>
</html>
